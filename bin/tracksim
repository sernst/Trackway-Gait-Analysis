#!/usr/bin/env python3

import os
import sys

# Add Tracksim to python path for this session
PROJECT_BIN_PATH = os.path.abspath(os.path.dirname(__file__))
sys.path.append(os.path.abspath(os.path.join(PROJECT_BIN_PATH, '..')))

import tracksim
from tracksim.cli import commands

# Add whitespace when the command is executed
print('\n')

if len(sys.argv) < 2:
    tracksim.log("""
    [ERROR]: tracksim requires a command argument that defines the operation
    to be carried out. The expected structure is:

        $ tracksim [COMMAND] [ARGUMENTS] [--OPTIONS]

    For a list of available commands run:

        $ tracksim help
    """)
    tracksim.end(1)

cmd = sys.argv[1].lower()

if cmd == 'help':
    tracksim.log('The following CLI commands are available:')
    commands.list_modules()

    tracksim.log("""
        For more information on the various commands, use the help flag on the
        specific command:

            tracksim [COMMAND] --help
        """, whitespace_top=1)
    tracksim.end(0)

command_module = commands.get_module(cmd)
if not command_module:
    tracksim.log("""[ERROR]: Unrecognized command "{}".""".format(cmd))
    tracksim.end(1)

command_module.execute_command()
tracksim.end(0)
